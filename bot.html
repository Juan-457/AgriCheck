<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flujo Bot WhatsApp | AgriCheck</title>
  <style>
    :root{
      --bg:#0f172a;
      --card:#111827;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --accent:#22c55e;
      --accent2:#38bdf8;
      --line:#1f2937;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 85% -10%, #1d4ed8 0%, transparent 55%), var(--bg);
      color:var(--text);
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:24px;
    }
    .wrap{width:min(1150px,100%)}
    h1{margin:0 0 6px;font-size:clamp(1.5rem,4vw,2.2rem)}
    .sub{color:var(--muted);margin:0 0 18px}
    .panel{
      border:1px solid var(--line);
      background:linear-gradient(180deg,#0b1220 0%, #0b1220cc 100%);
      border-radius:18px;
      padding:14px;
      backdrop-filter: blur(6px);
    }
    .layout{display:grid;grid-template-columns:1.1fr .9fr;gap:14px;align-items:start}
    .timeline{
      display:grid;
      gap:10px;
    }
    .step{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 14px;
      background:var(--card);
      opacity:.45;
      transform:translateY(6px);
      transition:.35s ease;
      cursor:pointer;
    }
    .step.active{opacity:1; transform:translateY(0); border-color:color-mix(in srgb, var(--accent2), #fff 8%);}
    .top{display:flex;align-items:center;gap:10px}
    .n{
      width:26px;height:26px;border-radius:999px;display:grid;place-items:center;
      font-size:.82rem;font-weight:700;background:#0b2035;color:#7dd3fc;border:1px solid #1d4ed8;
      flex:none;
    }
    .step.active .n{background:#072d1a;color:#86efac;border-color:#16a34a}
    .title{font-weight:700}
    .desc{color:#cbd5e1;margin-top:8px;display:none}
    .step.active .desc{display:block}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    button{
      border:1px solid #1e293b;background:#111827;color:var(--text);
      padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;
    }
    button:hover{border-color:#334155}
    .play{background:linear-gradient(90deg,#16a34a,#0ea5e9);border:0}
    .progress{
      height:7px;border-radius:999px;background:#0b1220;border:1px solid var(--line);margin:14px 2px 0;
      overflow:hidden;
    }
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:.35s ease}
    .phone{
      border:1px solid #334155;
      border-radius:24px;
      background:#020617;
      padding:12px;
      max-width:380px;
      margin-inline:auto;
      box-shadow:0 18px 40px #0008;
    }
    .notch{height:20px;width:120px;background:#0b1220;border-radius:0 0 14px 14px;margin:0 auto 8px}
    .wa{
      border:1px solid #1e293b;
      border-radius:16px;
      overflow:hidden;
      background:#0f172a;
    }
    .wa-top{padding:10px 12px;background:#0b2239;border-bottom:1px solid #1e293b;font-size:.92rem;font-weight:700;display:flex;align-items:center;gap:8px}
    .wa-avatar{width:28px;height:28px;border-radius:999px;overflow:hidden;border:1px solid #1d4ed8;background:#fff;flex:none;display:grid;place-items:center}
    .wa-avatar img{width:100%;height:100%;object-fit:cover}
    .wa-chat{padding:12px;background:linear-gradient(180deg,#0f172a,#111827);display:grid;gap:8px;min-height:380px}
    .msg{max-width:82%;padding:9px 10px;border-radius:10px;font-size:.92rem;line-height:1.35;border:1px solid transparent}
    .in{justify-self:start;background:#111827;border-color:#1f2937}
    .out{justify-self:end;background:#052e1f;border-color:#166534}
    .hint{color:#94a3b8;font-size:.83rem;margin:10px 4px 0}
    @media (max-width:900px){.layout{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Flujo del Bot de WhatsApp</h1>
    <p class="sub">Versi√≥n minimalista + din√°mica para presentar al cliente.</p>

    <section class="panel">
      <div class="layout">
        <div>
          <div id="timeline" class="timeline"></div>

          <div class="controls">
            <button id="prev">‚Üê Anterior</button>
            <button id="next">Siguiente ‚Üí</button>
            <button id="auto" class="play">‚ñ∂ Auto demo</button>
          </div>

          <div class="progress"><div id="bar" class="bar"></div></div>
          <p class="sub" style="margin:10px 2px 0; font-size:.92rem">Ejemplos tomados del prompt operativo de n8n.</p>
        </div>

        <aside class="phone" aria-label="Simulaci√≥n WhatsApp">
          <div class="notch"></div>
          <div class="wa">
            <div class="wa-top"><span class="wa-avatar"><img src="agrichecklogo.png" alt="Logo AgriCheck"/></span><span>AgriBot ¬∑ WhatsApp</span></div>
            <div id="chat" class="wa-chat"></div>
          </div>
          <p id="hint" class="hint"></p>
        </aside>
      </div>
    </section>
  </main>

  <script>
    const data = [
      {
        t:'Saludo inicial obligatorio',
        d:'Si el usuario saluda, el bot debe responder exactamente el saludo de AgriBot y pedir nombre, provincia y cultivo.',
        h:'Regla: nunca dejar un saludo sin respuesta.',
        m:[
          {k:'in',tx:'Hola, buen d√≠a'},
          {k:'out',tx:'Hola üëã Soy AgriBot de AgriCheck.'},
          {k:'out',tx:'Puedo brindarte informaci√≥n b√°sica de nuestros productos y derivarte con el asesor de tu zona.'},
          {k:'out',tx:'¬øMe compart√≠s tu nombre, provincia y cultivo?'}
        ]
      },
      {
        t:'Consulta de productos',
        d:'Cuando preguntan cat√°logo, responder listado b√°sico y cerrar con opci√≥n de derivaci√≥n.',
        h:'M√°ximo una l√≠nea por producto; sin detalle t√©cnico.',
        m:[
          {k:'in',tx:'¬øQu√© productos tienen para insectos?'},
          {k:'out',tx:'Trabajamos soluciones biol√≥gicas y especiales como Beauvisan, Nomu-Protec, T-Gro, Nexula-N, Tundrabac y Phosbac.'},
          {k:'out',tx:'Pod√©s ver el detalle completo ac√°: https://www.agrichecksrl.com/nuestros-productos.html'},
          {k:'out',tx:'¬øQuer√©s que te conecte con el asesor de tu zona?'}
        ]
      },
      {
        t:'Regla cero invento',
        d:'Si piden recomendaci√≥n t√©cnica, no diagnosticar ni dar dosis: derivar en una frase exacta.',
        h:'No recomendaciones agron√≥micas por WhatsApp bot.',
        m:[
          {k:'in',tx:'¬øQu√© dosis uso en tomate con trips?'},
          {k:'out',tx:'Para una recomendaci√≥n t√©cnica, te derivo con el asesor de tu zona.'}
        ]
      },
      {
        t:'Captura obligatoria antes del asesor',
        d:'Si falta nombre o cultivo, se pide ese dato. El tel√©fono se toma desde metadata de WhatsApp.',
        h:'No mostrar asesor antes de completar captura m√≠nima.',
        m:[
          {k:'in',tx:'Me interesa, soy de C√≥rdoba'},
          {k:'out',tx:'Perfecto ‚úÖ Ya puedo asignarte el asesor de tu zona. ¬øMe dec√≠s tu nombre?'},
          {k:'in',tx:'Soy Luc√≠a'},
          {k:'out',tx:'Gracias Luc√≠a ‚úÖ ¬øQu√© cultivo trabaj√°s?'}
        ]
      },
      {
        t:'Disparo HTTP y resultado',
        d:'Con nombre + tel√©fono + cultivo, ejecutar Capture lead (HTTP) y reci√©n despu√©s continuar.',
        h:'Aunque falle HTTP, igual se deriva al asesor.',
        m:[
          {k:'in',tx:'Trabajo ma√≠z'},
          {k:'out',tx:'Listo ‚úÖ Ya qued√≥ enviado. En breve te contactan.'},
          {k:'out',tx:'Perfecto ‚úÖ Por tu zona te corresponde:'}
        ]
      },
      {
        t:'Derivaci√≥n por zona',
        d:'Se muestra asesor asignado seg√∫n provincia/localidad; en Cuyo se muestran dos asesoras.',
        h:'Solo despu√©s del intento de captura HTTP.',
        m:[
          {k:'out',tx:'Asesor: Miguel Utrera'},
          {k:'out',tx:'Regi√≥n: N√∫cleo Centro'},
          {k:'out',tx:'WhatsApp: [LINK]'}
        ]
      },
      {
        t:'Anti-loop y salida segura',
        d:'Si no quiere dar datos, ofrecer WhatsApp general y no insistir m√°s de una vez.',
        h:'Mantener mensaje corto, profesional y directo.',
        m:[
          {k:'in',tx:'Prefiero no pasar mis datos'},
          {k:'out',tx:'Puedo pasarte el WhatsApp general de AgriCheck. Sin esos datos puede demorar un poco m√°s la asignaci√≥n.'},
          {k:'out',tx:'+54 9 2984 76-3055'}
        ]
      }
    ];

    const timeline = document.getElementById('timeline');
    const chat = document.getElementById('chat');
    const hint = document.getElementById('hint');
    const bar = document.getElementById('bar');
    let i = 0, timer = null;

    function draw(){
      timeline.innerHTML = data.map((s,idx)=>`
        <article class="step ${idx===i?'active':''}" data-i="${idx}">
          <div class="top">
            <div class="n">${idx+1}</div>
            <div class="title">${s.t}</div>
          </div>
          <div class="desc">${s.d}</div>
        </article>
      `).join('');
      chat.innerHTML = data[i].m.map(msg=>`<div class="msg ${msg.k}">${msg.tx}</div>`).join('');
      hint.textContent = data[i].h;
      bar.style.width = `${((i+1)/data.length)*100}%`;
      timeline.querySelectorAll('.step').forEach(el=>el.onclick=()=>{ i=+el.dataset.i; draw(); stopAuto(); });
    }

    function next(){ i = (i+1)%data.length; draw(); }
    function prev(){ i = (i-1+data.length)%data.length; draw(); }

    function startAuto(){
      if(timer) return;
      timer = setInterval(next, 1400);
      document.getElementById('auto').textContent = '‚è∏ Pausar demo';
    }
    function stopAuto(){
      clearInterval(timer); timer = null;
      document.getElementById('auto').textContent = '‚ñ∂ Auto demo';
    }

    document.getElementById('next').onclick = ()=>{ next(); stopAuto(); };
    document.getElementById('prev').onclick = ()=>{ prev(); stopAuto(); };
    document.getElementById('auto').onclick = ()=> timer ? stopAuto() : startAuto();

    draw();
  </script>
</body>
</html>
