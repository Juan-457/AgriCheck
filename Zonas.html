<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
  <link rel="shortcut icon" href="favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;800&display=swap" rel="stylesheet">
  <title>Mapa de Zonas</title>
  <style>
    html, body { height: 100%; min-height: 100%; }
    body{
      font-family:"Lato",system-ui,Segoe UI,Roboto,Arial,sans-serif;
      margin:0;
      min-height:100vh;
      overflow-x: hidden;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      background: radial-gradient(circle at 20% 20%, #12315f 0%, #0b1f3f 48%, #08162d 100%);
      color:#1f2937;
    }
    #bgMapLayer{position:fixed;inset:0;z-index:1;display:grid;place-items:center;pointer-events:auto;overflow:hidden}
    #bgMapContainer{width:100vw;height:100vh;opacity:.9;pointer-events:auto}
    #bgMapContainer svg{width:100%;height:100%;display:block}
    a { color: inherit; text-decoration: none; }
    .container{max-width:1320px;margin:0 auto;padding:0 6px}
    main.container{max-width:100%;padding:0 12px}
    header {
      position: relative;
      pointer-events: auto;
      z-index: 60;
      padding: 10px 0;
      background: linear-gradient(180deg, rgba(10, 21, 56, .78), rgba(10, 21, 56, .55));
      border-bottom: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 8px 24px rgba(0,0,0,.18);
    }
    .topbar {display:flex;align-items:center;justify-content:center;position:relative;min-height:44px;max-width:100%;padding:0 16px}
    .brandLogo {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      padding: 8px 16px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,255,255,.28), rgba(255,255,255,.38));
      border: 1px solid rgba(255,255,255,.46);
      box-shadow: 0 18px 36px rgba(0,0,0,.28);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .brandLogo img { height: 44px; width: auto; display: block; }
    .navlinks {
      display: flex;
      gap: 10px;
      padding: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
    }
    .navlinks a {
      padding: 10px 16px;
      border-radius: 999px;
      font-weight: 800;
      color: rgba(226,232,240,.95);
      letter-spacing: -0.01em;
      transition: background 0.15s ease, transform 0.15s ease, color 0.15s ease;
    }
    .navlinks a:hover {
      background: rgba(255,255,255,.12);
      transform: translateY(-1px);
      color: rgba(255,255,255,.98);
    }
    .navlinks a[aria-current="page"] {
      background: rgba(255,255,255,.16);
      color: #ffffff;
    }

    main{position:relative;z-index:5;padding:22px 0 24px;flex:1;overflow:visible;pointer-events:none}
    .pageFlow{display:flex;flex-direction:column;gap:0;min-height:100%;pointer-events:none}
    .heroLayout{display:grid;grid-template-columns:minmax(260px,.9fr) minmax(540px,1.55fr) minmax(250px,.68fr);gap:16px;align-items:start;margin-top:0.5cm;pointer-events:none}
    .card{
      border:1px solid #223046;
      border-radius:18px;
      padding:22px;
      background:#0E1B2A;
      box-shadow:0 16px 40px rgba(0,0,0,.45), inset 0 2px 0 rgba(255,255,255,.04);
      color:#fff;
      line-height:1.5;
    }
    .heroCopy{display:flex;flex-direction:column;justify-content:flex-start;gap:16px;min-height:0;pointer-events:auto}
    .heroCopy *{pointer-events:auto}
    .heroTop{display:flex;flex-direction:column;gap:16px}
    .heroCopy h1{margin:0;font-size:clamp(28px,3vw,40px);line-height:1.08;letter-spacing:-.02em}
    .heroCopy p{margin:0;color:#C9D3DD;line-height:1.55}
    .heroList{list-style:none;margin:0;padding:0;display:flex;gap:10px;flex-wrap:wrap}
    .heroList li{padding:8px 14px;border-radius:999px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);font-weight:700;color:rgba(248,250,252,.95)}
    #mapWrap{position:relative;display:flex;flex-direction:column;gap:10px;min-height:500px;padding:8px 8px 10px;overflow:hidden;background:transparent;backdrop-filter:none;-webkit-backdrop-filter:none;border-color:transparent;box-shadow:none;pointer-events:none}
    .mapHint{display:none;font-size:13px;color:#fde68a}
    .mapHint.visible{display:block}
    .vendorColumn{display:flex;align-items:flex-start;justify-content:center;padding-top:24px;pointer-events:auto}
    .vendorColumn *{pointer-events:auto}
    #panel{height:auto;max-height:100%;overflow:auto;padding:20px;align-self:flex-start;width:100%;max-width:380px}
    .zone{cursor:pointer;transition:fill .2s ease,opacity .15s}
    .tooltip{
      position:fixed;display:none;pointer-events:none;
      background:#111;color:#fff;padding:10px 12px;border-radius:12px;
      font-size:13px;gap:10px;align-items:center
    }
    .tooltip img{width:34px;height:34px;border-radius:50%;object-fit:cover;background:#333}
    .pill{display:inline-block;background:#13263A;border:1px solid #223046;border-radius:999px;padding:6px 10px;font-size:12px;color:#C9D3DD}
    .panelSection + .panelSection{margin-top:14px}
    .sectionTitle{margin:12px 0 8px;font-size:13px;letter-spacing:.04em;color:#9FB0C1;text-transform:uppercase}
    #panel img{width:96px;height:96px;border-radius:18px;object-fit:cover;background:#f3f4f6}
    .companyLogo{width:150px;height:auto !important;border-radius:12px !important;padding:6px;background:#fff}
    .companyData{margin:10px 0;color:#C9D3DD;line-height:1.55}
    .companyData p{margin:0 0 6px}
    .companyData a{color:#fff;text-decoration:underline}
    .contactCard{display:flex;align-items:center;gap:10px;padding:12px 14px;border-radius:14px;background:#13263A;border:1px solid #223046;transition:background .15s ease}
    .contactCard:hover{background:#16314A}
    .contactCard img{width:62px !important;height:62px !important;border-radius:14px}
    .contactMain{display:flex;flex-direction:column;gap:2px;min-width:0}
    .contactMain strong{font-size:17px;line-height:1.2}
    .contactMain span{color:#9FB0C1}
    .contactList{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .contactItem{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:8px;padding:12px 14px;border-radius:12px;background:#13263A;border:1px solid #223046;transition:background .15s ease}
    .contactItem:hover{background:#16314A}
    .contactInfo{min-width:0;flex:1}
    .contactItem p{margin:0;line-height:1.35}
    .contactLinks{display:flex;gap:8px;flex-shrink:0;flex-wrap:wrap;margin-left:auto}
    .miniBtn{display:inline-flex;align-items:center;justify-content:center;padding:7px 11px;border-radius:999px;border:1px solid #2A3B55;background:#122033;color:#fff;font-weight:700;font-size:12px;white-space:nowrap;transition:background .15s ease, box-shadow .15s ease}
    .miniBtn:hover{background:#16314A;box-shadow:0 8px 20px rgba(0,0,0,.25)}
    .vendorsGrid{display:flex;flex-direction:column;gap:8px}
    .vendorCard{padding:12px 14px;border-radius:12px;background:#13263A;border:1px solid #223046;transition:background .15s ease}
    .vendorCard:hover{background:#16314A}
    .vendorCard h3{margin:0 0 4px;font-size:14px;line-height:1.3}
    .vendorCard p{margin:0;color:#C9D3DD;font-size:12px}
    .vendorCard.is-hidden{display:none}
    .filterActions{display:flex;justify-content:flex-end;margin-bottom:8px}
    .ghostBtn{width:auto;padding:8px 12px;border-radius:999px;border:1px solid #2A3B55;background:#122033;color:#fff;font-size:12px;transition:background .15s ease, box-shadow .15s ease}
    .ghostBtn:hover{background:#16314A;box-shadow:0 8px 20px rgba(0,0,0,.25)}
    .ghostBtn[hidden]{display:none}
    button{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2A3B55;background:#122033;color:#fff;cursor:pointer;font-weight:700;transition:background .15s ease, box-shadow .15s ease}
    button:hover:not(:disabled){background:#16314A;box-shadow:0 8px 20px rgba(0,0,0,.25)}
    button:disabled{opacity:.4;cursor:not-allowed}

    .productsSection{margin-top:0;padding-top:4px}
    .productShowcase{display:flex;flex-direction:column;justify-content:flex-start;overflow:hidden;position:relative;max-width:250px;width:100%;margin:0 auto}
    .productShowcase::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg, rgba(3,8,24,.18), rgba(3,8,24,.48));pointer-events:none}
    .showcaseMedia{position:relative;z-index:1;border-radius:14px;overflow:hidden;border:1px solid #223046;box-shadow:0 16px 28px rgba(0,0,0,.26);min-height:170px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;background:#13263A;padding:12px}
    .showcaseMedia img{width:100%;height:100%;display:block;object-fit:contain;object-position:center;transition:opacity .45s ease}
    .typingName{position:static;transform:none;margin:0;font-size:clamp(15px, 1.6vw, 20px);line-height:1.15;font-weight:800;display:inline-block;min-height:1.2em;color:#0f172a;background:rgba(255,255,255,.9);padding:4px 10px;border-radius:999px;text-shadow:none;z-index:2;max-width:90%;white-space:normal;overflow-wrap:anywhere;text-align:center}
    .typingName::after{content:"";display:inline-block;width:2px;height:1em;background:rgba(255,255,255,.92);margin-left:5px;vertical-align:-1px;animation:blink .95s steps(1,end) infinite}
    .kpiStrip{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .kpiChip{padding:8px 14px;border-radius:999px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);color:#f8fafc;font-weight:700}
    .productsSection .sectionHead{display:flex;align-items:center;justify-content:center;margin-bottom:10px}
    
    @keyframes blink{50%{opacity:0}}




    @media (min-width: 961px){
      body{overflow-y:auto}
      main.container{padding:0 8px 8px}
      .pageFlow{min-height:calc(100vh - 86px)}
      #hero.heroLayout{
        grid-template-columns:minmax(250px,.85fr) minmax(520px,1.5fr) minmax(240px,.75fr);
        grid-template-areas:"copy map panel";
        height:100%;
      }
      .heroCopy{grid-area:copy;display:flex}
      .vendorColumn{grid-area:panel;display:flex;padding-top:0;align-items:stretch}
      #panel{align-self:stretch;max-height:none}
      #mapWrap{grid-area:map;min-height:0;height:100%;padding:12px}
    }

    @media (max-width: 1100px){
      .heroLayout{grid-template-columns:minmax(0,1fr) minmax(230px,.78fr);grid-template-areas:"copy copy" "map panel"}
      .heroCopy{grid-area:copy}
      #mapWrap{grid-area:map;min-height:480px}
      .vendorColumn{grid-area:panel}
    }

    @media (max-width: 960px){
      main{padding:10px 0 12px;overflow:auto}
      .topbar{justify-content:flex-end}
      .brandLogo{position:static;transform:none;margin-right:auto}
      .navlinks{gap:6px;padding:5px}
      .navlinks a{padding:8px 12px;font-size:14px}
      .heroLayout{grid-template-columns:1fr;grid-template-areas:"copy" "map" "panel";gap:14px}
      #mapWrap{min-height:430px}
      #panel{max-height:none;align-self:stretch}
      .productShowcase{max-width:none;margin:0 auto}
      .showcaseMedia{min-height:200px}
    }

  </style>
</head>
<body>
  <div id="bgMapLayer" aria-hidden="true">
    <div id="bgMapContainer"></div>
  </div>
  <header>
    <div class="container topbar">
      <a class="brandLogo" href="index.html" aria-label="AgriCheck inicio">
        <img src="agrichecklogo.png" alt="AgriCheck" />
      </a>
      <nav class="navlinks" aria-label="Navegación principal">
        <a href="index.html">Inicio</a>
        <a href="nuestros-productos.html#productos">Nuestros Productos</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="pageFlow">
      <section id="hero" class="heroLayout">
        <article class="card heroCopy">
          <div class="heroTop">
            <h1>Tecnología biológica para una agricultura más eficiente</h1>
            <p>Seleccioná tu zona y conectá con el equipo comercial más cercano para acelerar decisiones en campo.</p>
            <ul class="heroList">
              <li>Rendimiento y calidad</li>
              <li>Tratamientos de semillas</li>
              <li>Protección de cultivos</li>
            </ul>
          </div>

          <section id="productos" class="productsSection" aria-label="Nuestros productos">
            <div class="productShowcase">
              <div class="showcaseMedia">
                <img id="productImage" src="Parka.webp" alt="Producto destacado" />
                <h2 class="typingName" id="productName"></h2>
              </div>
            </div>
          </section>
        </article>

        <div id="mapWrap" class="card">
          <div id="mapHint" class="mapHint" role="status" aria-live="polite">Seleccioná una zona en el mapa de fondo para habilitar contacto directo con tu asesor.</div>

          <div id="tt" class="tooltip">
            <img id="ttImg" alt="">
            <div>
              <div id="ttName" style="font-weight:700"></div>
              <div id="ttMeta" style="opacity:.85;font-size:12px"></div>
            </div>
          </div>
        </div>

        <div class="vendorColumn">
          <aside id="panel" class="card">
            <div class="pill">Detalle</div>

            <div id="defaultPanel" class="panelSection">
              <h2 style="margin:10px 0 6px">AgriCheck SRL</h2>
              <img class="companyLogo" src="agrichecklogo.png" alt="Logo AgriCheck">
              <div class="companyData">
                <p><strong>Agroinsumos especiales</strong></p>
                <p>San Juan 50, General Roca, Argentina</p>
                <p><strong>Email:</strong> <a href="mailto:info@agrichecksrl.com">info@agrichecksrl.com</a></p>
                <p><strong>WhatsApp:</strong> <a href="tel:+5492984763055">+54 9 2984 76-3055</a></p>
              </div>
              <button id="defaultWa">Enviar WhatsApp</button>
            </div>

            <div id="sellerPanel" class="panelSection" hidden>
              <h2 id="pName" style="margin:10px 0 6px">Seleccioná una zona</h2>
              <div class="contactCard">
                <img id="pImg" alt="">
                <div class="contactMain">
                  <strong id="pMainName"></strong>
                  <span id="pMeta"></span>
                </div>
              </div>
              <div class="sectionTitle">Fuerza de ventas</div>
              <div id="salesForce" class="contactList"></div>
              <button id="pWa" disabled>Enviar WhatsApp principal</button>
            </div>

            <div class="panelSection">
              <div class="sectionTitle">Vendedores por zona</div>
              <div class="filterActions">
                <button id="clearFilter" class="ghostBtn" hidden>Mostrar todas las zonas</button>
              </div>
              <div id="vendorCards" class="vendorsGrid"></div>
            </div>
          </aside>
        </div>
      </section>

    </div>
  </main>


<script>
  // ✅ Datos (editá a gusto). Las "keys" deben matchear el title del SVG (normalizado)
  const sellers = {
    "Marcelo Lizondo": {
      fill:"rgba(255, 238, 188, 0.45)", hover:"rgba(255, 225, 156, 0.56)", stroke:"#f5d684", img:"agrichecklogo.png", meta:"Zona Norte",
      contacts:[{name:"Marcelo Lizondo", phone:"5493816083328", email:"marcelo.lizondo@agrichecksrl.com"}]
    },
    "Alan Schmidt": {
      fill:"rgba(221, 241, 255, 0.45)", hover:"rgba(197, 231, 255, 0.56)", stroke:"#93c5f6", img:"agrichecklogo.png", meta:"Zona Los Umas",
      contacts:[{name:"Alan Schmidt", phone:"5493455235949", email:"alan.schmidt@agrichecksrl.com"}]
    },
    "Miguel Utrera": {
      fill:"rgba(225, 246, 238, 0.45)", hover:"rgba(198, 237, 222, 0.56)", stroke:"#86d1bb", img:"Miguel.webp", meta:"Zona Centro",
      contacts:[{name:"Miguel Utrera", phone:"549372515563", email:"miguel.utrera@agrichecksrl.com"}]
    },
    "Evelyn Riveros y Daiana Gonzalez": {
      fill:"rgba(245, 232, 255, 0.45)", hover:"rgba(235, 214, 253, 0.56)", stroke:"#c7a5ef", img:"Diana.webp", meta:"Zona Oeste", displayName:"Evelyn Riveros y Daiana Gonzalez",
      contacts:[
        {name:"Evelyn Riveros", phone:"5492616076080", email:"evelyn.riveros@agrichecksrl.com"},
        {name:"Daiana Gonzalez", phone:"5492617648050", email:"daiana.gonzalez@agrichecksrl.com"}
      ]
    },
    "Andres Perez": {
      fill:"rgba(255, 233, 236, 0.45)", hover:"rgba(254, 209, 216, 0.56)", stroke:"#f2a8b3", img:"Andres.jpg", meta:"Zona Sur",
      contacts:[{name:"Andrés Perez", phone:"5492494151210", email:"andres.perez@agrichecksrl.com"}]
    },
    "Victoria Vianna": {
      fill:"rgba(255, 244, 224, 0.45)", hover:"rgba(255, 233, 196, 0.56)", stroke:"#f2c588", img:"agrichecklogo.png", meta:"Zona Andina",
      contacts:[{name:"Victoria Vianna", phone:"5492984308032", email:"victoria.vianna@agrichecksrl.com"}]
    },
    "Anibal Epullan": {
      fill:"rgba(235, 240, 255, 0.45)", hover:"rgba(214, 224, 253, 0.56)", stroke:"#9cb0ef", img:"agrichecklogo.png", meta:"Zona Patagonia",
      contacts:[{name:"Anibal Epullan", phone:"5492984309419", email:"anibal.epullan@agrichecksrl.com"}]
    }
  };

  const normalizeZoneName = (value = "") =>
    value
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/[^a-zA-Z0-9]+/g, " ")
      .trim()
      .toLowerCase();

  const sellersByNormalizedName = Object.fromEntries(
    Object.entries(sellers).map(([name, info]) => [normalizeZoneName(name), info])
  );

  const tt = document.getElementById("tt");
  const ttImg = document.getElementById("ttImg");
  const ttName = document.getElementById("ttName");
  const ttMeta = document.getElementById("ttMeta");

  const pName = document.getElementById("pName");
  const pImg = document.getElementById("pImg");
  const pMeta = document.getElementById("pMeta");
  const pMainName = document.getElementById("pMainName");
  const pWa = document.getElementById("pWa");
  const salesForce = document.getElementById("salesForce");
  const defaultPanel = document.getElementById("defaultPanel");
  const sellerPanel = document.getElementById("sellerPanel");
  const defaultWa = document.getElementById("defaultWa");
  const mapHint = document.getElementById("mapHint");
  const vendorCards = document.getElementById("vendorCards");
  const clearFilter = document.getElementById("clearFilter");

  const companyWhatsapp = "5492984763055";
  const productImage = document.getElementById("productImage");
  const productName = document.getElementById("productName");

  const featuredProducts = [
    { name: "Parka", image: "Parka.webp" },
    { name: "T-Gro WP", image: "T-Gro WP.webp" },
    { name: "Nexula", image: "nexula.webp" },
    { name: "Nomu Protec", image: "Nomu.webp" },
    { name: "Tundrabac", image: "Tundrabac.webp" },
    { name: "Beauvisan", image: "Beavisan 1Kg.webp" },
    { name: "Superfifty Prime", image: "Superfifty.webp" }
  ];

  let productIndex = 0;
  let typingTimeout;
  let cycleInterval;
  let selectedPrimaryContact = null;
  let selectedDisplayName = "";
  let selectedZoneElement = null;

  defaultWa.addEventListener("click", () => {
    const msg = encodeURIComponent("Hola AgriCheck, quiero hacer una consulta.");
    window.open(`https://wa.me/${companyWhatsapp}?text=${msg}`, "_blank");
  });



  function highlightMapSelectionHint(){
    mapHint.classList.add("visible");
    document.getElementById("mapWrap").scrollIntoView({ behavior:"smooth", block:"center" });
    setTimeout(() => mapHint.classList.remove("visible"), 2600);
  }

  function moveTooltip(e){
    tt.style.left = (e.clientX + 12) + "px";
    tt.style.top  = (e.clientY + 12) + "px";
  }

  function getSeller(name){
    return sellers[name] || sellersByNormalizedName[normalizeZoneName(name)];
  }

  function formatPhone(phone){
    if(!phone) return "";
    return `+${phone}`;
  }

  function typeProductName(text, speed = 72){
    clearTimeout(typingTimeout);
    productName.textContent = "";
    let i = 0;

    const typeStep = () => {
      productName.textContent = text.slice(0, i);
      i += 1;
      if(i <= text.length){
        typingTimeout = setTimeout(typeStep, speed);
      }
    };

    typeStep();
  }

  function showProduct(index){
    const product = featuredProducts[index];
    if(!product) return;
    productImage.style.opacity = "0";
    setTimeout(() => {
      productImage.src = product.image;
      productImage.alt = product.name;
      productImage.style.opacity = "1";
    }, 180);
    typeProductName(product.name);
  }

  function startProductShowcase(){
    showProduct(productIndex);
    clearInterval(cycleInterval);
    cycleInterval = setInterval(() => {
      productIndex = (productIndex + 1) % featuredProducts.length;
      showProduct(productIndex);
    }, 4200);
  }


  function openPanel(name){
    const s = getSeller(name);
    if(!s) return;
    const displayName = s.displayName || name;
    selectedDisplayName = displayName;
    selectedPrimaryContact = (s.contacts && s.contacts[0]) || null;
    mapHint.classList.remove("visible");
    defaultPanel.hidden = true;
    sellerPanel.hidden = false;
    pName.textContent = displayName;
    pImg.src = s.img;
    pMainName.textContent = (s.contacts && s.contacts[0]?.name) || displayName;
    pMeta.textContent = s.meta || "";
    salesForce.innerHTML = "";

    (s.contacts || []).forEach((contact) => {
      const phone = formatPhone(contact.phone);
      const item = document.createElement("div");
      item.className = "contactItem";
      item.innerHTML = `
        <div class="contactInfo">
          <p><strong>${contact.name}</strong></p>
          <p>${phone}</p>
          <p><a href="mailto:${contact.email}">${contact.email}</a></p>
        </div>
        <div class="contactLinks">
          <a class="miniBtn" href="https://wa.me/${contact.phone}" target="_blank" rel="noopener noreferrer">WhatsApp</a>
          <a class="miniBtn" href="mailto:${contact.email}">Email</a>
        </div>
      `;
      salesForce.appendChild(item);
    });

    const primary = selectedPrimaryContact;
    pWa.disabled = !primary?.phone;
    pWa.onclick = () => {
      if(!primary?.phone) return;
      const msg = encodeURIComponent(`Hola ${displayName}, te contacto por tu zona.`);
      window.open(`https://wa.me/${primary.phone}?text=${msg}`, "_blank");
    };
  }


  function renderVendorCards(){
    vendorCards.innerHTML = "";
    Object.entries(sellers).forEach(([sellerName, info]) => {
      const card = document.createElement("article");
      card.className = "vendorCard";
      card.dataset.seller = sellerName;
      card.innerHTML = `
        <h3>${info.displayName || sellerName}</h3>
        <p>${info.meta || "Sin zona"}</p>
      `;
      vendorCards.appendChild(card);
    });
  }

  function filterVendorCards(name){
    const normalized = normalizeZoneName(name);
    vendorCards.querySelectorAll(".vendorCard").forEach((card) => {
      const visible = normalizeZoneName(card.dataset.seller) === normalized;
      card.classList.toggle("is-hidden", !visible);
    });
    clearFilter.hidden = false;
  }

  function showAllVendorCards(){
    vendorCards.querySelectorAll(".vendorCard").forEach((card) => card.classList.remove("is-hidden"));
    clearFilter.hidden = true;
  }

  function clearSelectedZone(){
    if(!selectedZoneElement) return;
    selectedZoneElement.classList.remove("selected-zone");
    selectedZoneElement.style.strokeWidth = "2";
    selectedZoneElement.style.opacity = "0.88";
    selectedZoneElement = null;
  }

  function setSelectedZone(zoneEl, name){
    clearSelectedZone();
    selectedZoneElement = zoneEl;
    zoneEl.classList.add("selected-zone");
    zoneEl.style.strokeWidth = "3";
    zoneEl.style.opacity = "1";
    openPanel(name);
    filterVendorCards(name);
  }

  async function loadMap(){
    const mapContainer = document.getElementById("bgMapContainer");
    const response = await fetch("./argentina-zonas.svg");
    if(!response.ok) throw new Error("No se pudo cargar el mapa SVG");

    const svgText = await response.text();
    mapContainer.innerHTML = svgText;

    const backgroundSvg = mapContainer.querySelector("svg");
    if(backgroundSvg){
      backgroundSvg.setAttribute("preserveAspectRatio", "xMidYMid slice");
    }

    mapContainer.querySelectorAll("path[title], polygon[title]").forEach(zone => {
      zone.classList.add("zone");
      zone.dataset.zone = zone.getAttribute("title")?.trim() || "";
      zone.style.pointerEvents = "auto";

    });
  }

  // ✅ Inicializar zonas (se ejecuta cuando el SVG está en el DOM)
  function initZones(){
    const zones = document.querySelectorAll("#bgMapContainer .zone");
    zones.forEach(z => {
      const name = (z.dataset.zone || "").trim();
      const s = getSeller(name) || {};
      const baseFill = "rgba(0, 0, 0, 0.52)";
      const hoverFill = "rgba(0, 0, 0, 0.68)";
      const stroke = "rgba(255, 255, 255, 0.42)";

      z.style.fill = baseFill;
      z.style.stroke = stroke;
      z.style.strokeWidth = "2";
      z.style.opacity = "0.88";

      z.addEventListener("mouseenter", (e)=>{
        z.style.fill = hoverFill;
        z.style.opacity = "1";
        ttName.textContent = s.displayName || name;
        ttMeta.textContent = s?.meta ?? "Sin datos";
        ttImg.src = s?.img ?? "";
        tt.style.display = "flex";
        moveTooltip(e);
      });
      z.addEventListener("mousemove", moveTooltip);
      z.addEventListener("mouseleave", ()=> {
        z.style.fill = baseFill;
        z.style.opacity = "0.88";
        tt.style.display = "none";
      });
      z.addEventListener("click", ()=> setSelectedZone(z, name));
    });
  }


  window.addEventListener("load", async () => {
    try {
      renderVendorCards();
      clearFilter.addEventListener("click", () => {
        showAllVendorCards();
        clearSelectedZone();
      });
      await loadMap();
      initZones();
      showAllVendorCards();
      startProductShowcase();
    } catch (error) {
      document.getElementById("bgMapContainer").innerHTML = '<p style="color:#fff;text-align:center">No se pudo cargar el mapa.</p>';
      console.error(error);
    }
  });
</script>
</body>
</html>
